下記の構成は著作時点のものであり、今後の変更の可能性がある。

# 現在のシステム構成
この章には、すでに実現しているシステム構成のみを書いてください。  
今後の設計目標の記述は、なるべく別の章を設け、そちらに記述してください。当「現在のシステム構成」には、今後の設計目標は記述しないでください。  

## ソースファイルの構成
- sujinikuRpgRuntimeCppWin32.cpp がエントリーポイント。
- GameData にゲーム用素材(画像など)を入れている。
- ファイル分割は行ってない。

## モード仕様
### 基本モード
ゲーム中では、ゲーム状態が下記の基本モードに分類される。

モード名     |モード番号|変数名|
-----------:|-------:|-------:|
オープニング  |     100|    MODE_OP|
初期イベント  |     200|     MODE_INITIAL|
マップ       |     300|     MODE_MAP|
メニュー画面  |     400|     MODE_MENU|
戦闘         |     500|     MODE_BATTLE_COMMAND|

番号に、とくに深い意味は無い。

「メニュー画面」とは、「道具」や「装備」などを行うための画面。

### 詳細モード
実際には、上記の基本モードに加え、さらに細かく分類されている場合もある。

戦闘コマンド : MODE_BATTLE_COMMAND  
戦闘勝利 : MODE_BATTLE_WIN  
のように、個別のモードに分類される場合もある。

戦闘勝利(MODE_BATTLE_WIN)は「580」番としている。このように、最上位から2個目以降のケタを、細かな分類に使用している。ソースコードを確認する必要がある。

## フォント
Windows標準のフォントを使用する設定である。  
このゲーム自体には、フォントを組み込んでいない。  
ソースコードでは、フォントについて、指定するような処理は行っていない。  

## 関数の内容
WM_PAINT では、描画のみを行う。描画以外のゲーム進行用の計算は WM_PAINT では行わない。
ゲーム進行用の処理は、キーボード入力を扱う WM_KEYDOWN またはタイマー処理 WM_TIMER に、ある。  

__マップ画面での関数__  
Draw_map : マップ画面の描画用の関数。
check_movable : 矢印キーで指定された移動予定地が、移動可能を判定するための関数。
check_encount_enemy : モンスターとの遭遇の判定。  
check_MapTransition : 移動した場所がワープゾーンかどうかの判定。(マップの出入り口も、ワープゾーンに含む。)

__メニュー画面__  
item_select : アイテムメニューでのカーソル位置の計算用。

__戦闘の関数__  
battle_start : 戦闘に突入する際の、必要な代入を行っている。敵のHPなどの代入。  
hero_attack : 戦闘において、主人公が攻撃する場合の処理。  
enemy_attack : 戦闘において、敵が攻撃する場合の処理。  

draw_battle_common_before : 戦闘画面の背景を描画する関数。とはいっても、現状では、真っ白な背景しかないが。  
draw_battle_common_after : 戦闘画面のHP表示欄を描画するための関数。HPは戦闘中、原則的に、ずっと表示されている。

draw_battle_HeroDamage : 主人公パーティの受けたダメージを描画。敵とは表示位置が違うので、別の関数で行う。  
draw_battle_EnemyDamage : 敵の受けたダメージを描画。  




## 構造体の内容
chara_chip_def : 主人公のマップ画面での、それぞれの向き（上下左右）のキャラチップの画像ハンドルをグループ化するための構造体。

item_def : 「薬草」などアイテムの定義を行っている構造体  
item_have : 主人公のアイテム保持数などを保管する予定の構造体。（作業中のため不完全）  

monster_def : モンスターの定義。名前（スライム、コボルトなど）や最大HPなど。モンスターの番号（ID）も、これに含める。

MapTrans_def : ワープゾーンの構造体。 各マップの入口や出口も、ワープゾーンとして扱っているので、この構造体を使っている。

## 変数の内容
変数が多すぎるので、すべての変数は、紹介していない。  

mode_scene : 現在のモード（戦闘モードやオープニング画面モードなど）のモード番号の管理のための変数。

next_attack_flag : 次に誰が攻撃するか？ 現状のシステムでは、戦闘モードには敵と主人公の2人しか戦闘に参加してないので、これで管理している。

encount_monters_id : 敵に遭遇したとき、そのモンスターのIDを保存。誰を相手に戦うかを記録している。  
monster_name : 遭遇したモンスターの名前を保存している。  
monster_hp : 遭遇したモンスターのHPを保存している。  
encount_mons_alive : 遭遇したモンスターの生死を区別するフラグ。死亡したなら0に設定する。生きていれば1に設定。  

__選択項目__  
selecting_OP : これはオープニング画面にある「はじめから」「つづきから」などの選択画面で、何番目のコマンドを選択しているかを記録している。なお1番目は「はじめから」、2番目は「つづきから」。

selecting_mainmenu : 「道具」や「装備」などを行うためのメインメニュー画面で、何番目のコマンドを選択しているかを記録している。


__主人公のパラメータ__  
your_money : 主人公パーティの所持金。 とはいっても現状では、パーティは主人公1人しかいないが。

hero_hp : 主人公の現在のヒットポイント。HP。 0になると、ゲームオーバー。  
hero_hp_max : 主人公の最大ヒットポイント。  
hero_agility : 主人公の素早さ。  

hero_exp : 主人公がいままで獲得してきた経験値の累積。


__会話システム__  
drawTalkString1 : 会話ウィンドウの1行目のテキスト。  
drawTalkString2 : 会話ウィンドウの2行目のテキスト。  
drawTalkString3 : 会話ウィンドウの3行目のテキスト。  

なお、テキストを入れるので、drawTalkString1～3は配列変数である。  
配列のカッコ記号を使うとGitHubがwebリンクと誤解するため、仕様書ではカッコ記号を省略。  

__マップ__  
where_map : 主人公パーティが何番目のマップにいるか?   
maptable : 主人公の現在地のマップの地形データを現す2次元配列。なお、個別のマップの定義は、別の変数で行っている。  


chara_x : 主人公がマップ上でX座標の何マス目にいるか？  
chara_y : 主人公がマップ上でY座標の何マス目にいるか？  

start_x :  ゲーム開始時点のマップで、主人公がX座標の何マス目にいるか？
start_y :  ゲーム開始時点のマップで、主人公がY座標の何マス目にいるか？    

desti_x : 主人公の移動先または移動先予定のX座標。矢印キーを押したとき等に計算される。  
desti_y :  主人公の移動先または移動先予定のY座標。  
移動先の予定地が、移動可能なマスなら、desti の内容が、主人公の位置（chara_x など）に代入される仕組み。

direction : マップ上での主人公などキャラクターの向きを表す列挙体。上、下、右、左のいずれか。
hero1_direction : マップ上での主人公の向きを表す変数。主人公だけ。ほかのキャラクターは、ほかの変数で表す。 


MapTrans_position_x : ワープゾーンのX位置。 各マップの入り口や出口も、ワープゾーンとして処理しているので、この変数を使っている。  
MapTrans_position_Y : ワープゾーンのY位置。

 
positionX_enemy : マップ上でのモンスターの位置のX座標。このゲームには、モンスターがマップ上に表示される機能がある。  
positionY_enemy : マップ上でのモンスターの位置のY座標。


kCount : マップ画面でのキーボード入力を、一定時間内には一定量に制限するための変数であり、時間経過によって増える変数。


## その他
戦闘は、コマンドを入力し終わると、次のターンまで、タイマーで自動進行する。タイマー用のカウント変数として iCount という名の変数を使用している。  
このゲームは、ターン制のバトルのRPGである。  
