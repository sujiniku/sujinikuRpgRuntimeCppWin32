2019/11/24

# 目次_検索用ワード
これから取り掛かる作業_bookmark  
共通システム_bookmark  
マップ_bookmark  
戦闘_ bookmark   
社会活動_bookmark  
解決した作業_bookmark  



# これから取り掛かる作業_bookmark
（各タスクが終わったら、それぞれ下記ブックマークの適切な場所に移動してください。）  


所持武器と現在装備を交換する機能を実装すること。
（武器を買うシステムはあるが、まだそれを装備できるようになっていない）


防具の所持数のセーブはまだ。そもそも防具屋がまだ未完成。
（完了?）武器の所持数のセーブ。理由：これが無いと、装備システムのデバッグが困難なので。

「買う」モードの搭載

武器屋から出たときは、武器屋を暗くするか、表示を消す。（そうしないと、モード変化した事が分かりづらい。）



 中古品の購入モード。
（完了?）装備とか買い物とか、作ってみよう。
（完了）買い物モードのXボタンのキャンセル搭載。

（完了?）買い物の品物の追加
（完了?）装備品を作ってみる。
（完了?）武器の購入システムは出来たが、それをアイテム欄に表示する機能が無いので、アイテム欄に所持武器の表示機能を作る。



戦闘の特技の搭載。
戦闘オートシステムの搭載。

さっさと、一通りシステム搭載して、一応の完成をさせて終わらせる。


（完了）ウィザードリィのように、街に入ったら、移動先を選ばせてみる。
（完了）ギルドを街として流用。

（完了）まず、宿屋から作るのがラクそう。





シミュレーションRPGモードの搭載。

ギルドにシミュモードのコマンド。
マップは2番目を流用。



(無理そう)タスクバーに収納したときに前モードの背景の消える現象の解決。
・前モード背景画像のハンドル保存。



（※ 要・検討）【出動中】を選択したら、自動的にリムーブモードに

（完了）ギルドモードをギルドメインモードに改名。ページ内の効率化のため。

（完了）今度は仲間を外す処理も実装したい。

（完了）ピエールなどもギルドに入れ出しできるように。

（仕様変更）ギルドで外した仲間が控えに来る処置。(外せるけど、そいつが控えに来ない)　※　レイアウト変更



（完了）外したキャラを【空き枠】に。

（ひとまず完了）ゴンザレスでなくペドロを仲間にする処理の実装。




典型イベントのヒナ型。（討伐クエストとか）



はじめての戦闘を検出。



戦闘の敵パーティ定義の整備。（現在はまだヒナ形。連動してない。）



（完了）気絶してても、ケガが回復する、リアリティあるシステムを実装したい。


（完了）仲間構造体に、現在パーティ加入中かどうかの判定フラグを追加する。




（完了）仲間を増やす。





(完了)最小化してタスクバーにしまって、また出したときに背景が消えてしまう。


（完了）なので、面倒だけど、毎回、背景を描画する。チラツキも無くできた。



(完了)道具のカーソルは所持数を越えて移動しないように。
(完了)ゼロになったアイテムが道具欄から消えるように。（もしくは、未入手のアイテムが表示されないように。）

(完了)道具の表示/非表示はドラクエ方式。（イース3方式には、しない。）







(完了)とりあえず、モンスター撃破数を検出。
(完了)そのエリアのモンスター掃討を検出。
















(たぶん完了)選択ウィンドウ以外は、半透明で隠す必要がある。GDI+とか必要になりそうなので、調べる必要がある。


(たぶん完了)味方パーティに回復アイテムを使えるように。
(完了)アイテム選択で、対象者の選択の画面を作る。

(完了)対象者の決定後のアイテム効果の発動まで実装。







マップの10×10への拡大。キリも良く規格化しやすいだろう。  

マップ描画関数の、モンスターの位置の描画が、特定のマップエリアに依存しているので、  
依存しない形に書き換える必要がある。  


マップエリア番号を配列化。  

マップ名については、マップエリア番号とは別に宣言する。  

各エリアごとのモンスターを配列化。そのため開発用にマップ2にもモンスターを配置。  

（作業中）画像ファイルなどを毎回読み込むのではなく、ロード画面を設けて、最初に1回だけロードする方式に変更すべし。  


モンスター以外は WM_CREATE などに画像ロードの宣言を移動。  

また、マップ遷移時にもロードをするようにしてある。  



乱数も同様に、できれば、乱数リストみたいなのをつくり、どこかでロード。  

（作業中）中間スクリプト読み込み方式に対応させる。

そろそろファイル分割を始める。  
きっと、これをすれば、中間スクリプト読み込み方式にも、参考になるだろう。  


（とりあえず導入）移動が早すぎると操作性が悪いし、メモリにも負担をかけかねないので、  

(完了)タイマーの導入。  


（完了）乱数の種が、戦闘用の関数で毎回、作成されているのを修正。→ wWinMain に移動済み。  



（完了）戦闘で味方が行動不能になったとき、「○○の攻撃！」の表示が出ないように修正する。

（完了）とりあえず「○○は動けない！」にメッセージを変えよう。


（完了）逃げるコマンドの実装。戦闘不能になると、何も攻撃できず、ヒマなので。

（完了）一歩前にいた場所の記録。




__作業の課題__  

ソースファイルで読み込みファイル名を指定するのではなく、  
別のファイルで、読み込みファイル名を指定するようにする。（きっと、これが中間スクリプトになるだろう。）  

そのため、C言語の FOPEN のファイル読み取り機能を利用する。  

__ファイル構成の変更__

（完了）中間スクリプト用のフォルダを作る。 → GameData フォルダを作った。  

（完了）画像素材用のフォルダを作る。 → GameDataフォルダにぶっこんだ。  

（完了）とりあえず、「GameData」みたいなフォルダを作る。 → GameData フォルダを作った。  



__廃止された機能__

ファイル埋め込み機能を排除。  
（理由） 画像読み込みのコード量が2倍になり、めんどくさいので。  



# 共通システム_bookmark

（中止）実行ファイルは画像 埋め込み式 にする。  
（中止理由） ツクールやウディタは中間スクリプト読み込み方式なので。  

(備考)なお上記ソフトの画像などは、ツクールなどでは中間スクリプトに置き換えて暗号化してると考えられる。  


画像の埋め込み作業の実行には、Visual studioが必要になってしまう。    
しかし多くのアマチュアのゲーム作家は、Visual Studioを使えないので、画像の埋め込みは廃止。  


* 埋め込み式を考えた理由:   

GitHubで実行ファイルの画像を管理したくない。画像は多くなるので。  


# マップ_bookmark

マップをファイル分割する。  


マップの構造体化。関連ある要素をまとめる。  
そのためには、配列を要素とする構造体について、調べなければならない。  
(理由)マップデータは構造体なので。  

（完了）マップの遷移を作れ。  

（完了）そのためには、いまどこのマップにいるかの変数を作らなければいけない。  

アイテムがゼロ個になったら消える処理。  

2番目のアイテム。「高級な薬草」みたいなアイテム。  


セーブデータの実装は、すっとあとで。  

# 戦闘_bookmark

特技の実装。  

（完了）戦闘中、「〇〇の攻撃！」みたいなメッセージ表示。やっぱ無いと分かりづらい。パーティが増えたので誰がどの敵に攻撃してるかを表示する必要が生じた。

（完了）ダメージを画面に表示する機能  

（完了）戦闘用の、タイマー用のフラグを列挙体にする。  

（完了）Battle のコマンド用の関数名の変更。  

（完了）戦闘のタイマー処理。(コマンド決定後をオート処理に。)  

（完了）敵の攻撃機能。  


（完了）戦闘画面の実装。  
（完了）そのためには、モンスターを実装しなければならない。  




（完了）戦闘開始の関数化。

（完了） モンスターを構造体にすべし。→完了（とりあえず）

（完了）自分の攻撃機能を実装。 → 完了


# 未分類_bookmark
## 各種メニュ_bookmark
（未実装）ステータス画面の実装。

（未実装）名前の入力欄の実装。

メニュー画面の実装。 → 作業中


# 未分類_bookmark
マップ上の他人物の実装。 → モンスターは配置済み

モンスター以外の人物を配置する。会話をくれる人など。


パーティ人数の2人以上の対応。

各種のコードの関数化。

(これは何？)まず、キーボード受け付けをするAPIをつくる。


# 社会活動_bookmark
宣伝。（ある程度、進んだら。）


# 解決した作業_bookmark
## 冒頭イベント

（完了）冒頭イベントのメッセージ表示時期にマップも表示させる。

## マップ関係
（完了）マップの定義を独立させる必要がある。

（完了）また、マップと、そのマップ上でのイベントを、どこかに、まとめる。

（完了）移動判定のコードなど、複数の箇所で使うコードは関数にする。


## メニュー画面
（完了）道具、「薬草」の定義などをつくる。

（完了）道具、装備、技能、セーブの4コマンドの張りぼてを実装。
